<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Delivery Drivers Log â€“ Ravintola Tandoori Villa</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
  <style>
    :root {
      --main-bg: linear-gradient(135deg, #0d47a1 0%, #000 100%);
      --card-bg: #181c24;
      --primary: #42a5f5;
      --primary-hover: #1976d2;
      --accent: #bbdefb;
      --border: #212a40;
      --red: #ff3b30;
      --gap: 24px;
      --card-radius: 15px;
    }
    html, body {
      min-height: 100vh;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      box-sizing: border-box;
      width: 100vw;
      font-family: 'Poppins', Arial, sans-serif;
      color: #fff;
      overflow-x: hidden;
    }
    body {
      width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .page-wrapper {
      width: 100vw;
      max-width: 100vw;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      padding: 0;
      box-sizing: border-box;
    }
    .header {
      width: 100%;
      background: var(--card-bg);
      color: var(--accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 19px 16px 12px 16px;
      margin: 0 0 var(--gap) 0;
      margin-top: 24px;
      border-radius: var(--card-radius);
      box-shadow: 0 2px 9px rgba(66, 165, 245, 0.08);
      min-height: 43px;
      letter-spacing: 0.03em;
      max-width: 1100px;
      align-self: center;
    }
    .header-row {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .header-title {
      font-size: 1.17rem;
      font-weight: 800;
      color: #fff;
      font-family: 'Poppins', Arial, sans-serif;
      letter-spacing: 0.03em;
      text-shadow: 0 2px 12px #009de044;
      white-space: nowrap;
      flex: none;
      display: inline-flex;
      align-items: center;
      gap: 0.6em;
    }
    .header-desc {
      font-size: 0.99em;
      font-weight: 500;
      color: #bbdefb;
      opacity: 0.88;
      margin-left: 18px;
      font-family: 'Poppins', Arial, sans-serif;
      letter-spacing: 0.01em;
      text-align: center;
      flex: none;
      display: inline-block;
      white-space: normal;
      max-width: 68vw;
    }
    .driver-addbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.45em;
      margin: 13px 0 16px 0;
      width: 100%;
      max-width: 600px;
      padding: 0 3px;
      align-self: center;
    }
    .driver-addbar input[type="text"] {
      flex: 1;
      font-size: 1em;
      padding: 0.55em 1em;
      background: #212a40;
      border: none;
      border-radius: 9px;
      color: var(--accent);
      outline: none;
      font-family: 'Poppins', Arial, sans-serif;
      font-weight: 600;
      margin-right: 0.07em;
    }
    .driver-addbar button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 9px;
      font-size: 0.97rem;
      font-weight: 700;
      padding: 7px 18px;
      cursor: pointer;
      transition: background 0.16s;
      font-family: inherit;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 0.22em;
    }
    .driver-addbar button:hover { background: var(--primary-hover);}
    .log-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      width: 100vw;
      max-width: 100vw;
      align-items: stretch;
      margin: 0 auto 17px auto;
      padding: 0 24px;
      box-sizing: border-box;
      justify-items: center;
      overflow-x: hidden;
    }
    .driver-card {
      background: var(--card-bg);
      border-radius: var(--card-radius);
      box-shadow: 0 2px 8px rgba(66,165,245,0.08);
      border: 2px solid var(--border);
      padding: 0;
      display: flex;
      flex-direction: column;
      min-width: 370px;
      max-width: 480px;
      font-size: 0.97rem;
      position: relative;
      margin-bottom: 0;
      word-break: break-word;
      transition: border 0.13s, box-shadow 0.13s;
      width: 100%;
      box-sizing: border-box;
    }
    .driver-card.active {
      border: 2.2px solid var(--primary);
      box-shadow: 0 2px 12px #42a5f52a;
    }
    .driver-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 23px 8px 23px;
      background: #0d47a1;
      color: var(--accent);
      font-size: 1.07em;
      font-weight: 700;
      gap: 8px;
      border-bottom: 1px solid var(--border);
      border-top-left-radius: var(--card-radius);
      border-top-right-radius: var(--card-radius);
    }
    .driver-card-header .driver-name {
      font-size: 1.08em;
      font-weight: 700;
      color: #fff;
      flex: 1;
      letter-spacing: 0.04em;
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
      word-break: break-word;
    }
    .driver-card-header .driver-date {
      font-size: 0.97em;
      color: #d5f5ff;
      background: #183350;
      border-radius: 0.5em;
      padding: 3px 12px;
      border: none;
      outline: none;
      font-family: inherit;
      font-weight: 600;
      margin-left: 8px;
    }
    .driver-card-header .driver-delete {
      color: var(--red);
      font-size: 1.14em;
      border: none;
      background: none;
      cursor: pointer;
      margin-left: 7px;
      border-radius: 50%;
      padding: 0.07em 0.36em;
      transition: background 0.11s;
    }
    .driver-fields-row {
      display: flex;
      align-items: center;
      gap: 1.2em;
      margin: 13px 0 3px 0;
      padding: 0 15px;
      justify-content: stretch;
    }
    .driver-fields-row label {
      font-size: 1em;
      font-weight: 600;
      color: #bbdefb;
      margin-right: 0.14em;
      font-family: inherit;
      white-space: nowrap;
    }
    .input-km-wrap {
      display: inline-flex;
      align-items: center;
      border-radius: 7px;
      background: #212a40;
      box-shadow: 0 1px 4px #009de018;
      margin: 0 0.15em;
      padding-left: 0.15em;
      padding-right: 0.2em;
    }
    .input-km-wrap input[type="number"] {
      width: 4.5em;
      font-size: 1.07em;
      padding: 0.42em 0.12em 0.42em 0.55em;
      background: #212a40;
      border: 1px solid #384164;
      border-radius: 7px 0 0 7px;
      color: #fff;
      outline: none;
      text-align: center;
      font-family: inherit;
      font-weight: 700;
      white-space: nowrap;
      box-shadow: none;
    }
    .input-km-wrap .km-unit {
      font-size: 0.98em;
      color: #7ec5fd;
      margin-left: 0.2em;
      margin-right: 0.3em;
      font-weight: 700;
      white-space: nowrap;
      background: transparent;
      border: none;
      padding: 0;
      pointer-events: none;
      user-select: none;
    }
    .driver-km-result {
      margin: 0 0 2px 0;
      font-size: 1.08em;
      font-weight: 700;
      color: var(--primary);
      font-family: inherit;
      letter-spacing: 0.04em;
      text-align: left;
      padding: 0 15px;
      min-height: 21px;
      display: flex;
      align-items: center;
      gap: 0.4em;
    }
    .driver-timer-bar {
      display: flex;
      align-items: center;
      gap: 0.6em;
      margin: 0 0 2px 0;
      min-height: 1.4em;
      padding: 0 15px;
    }
    .driver-timer {
      font-size: 1.08em;
      font-weight: 800;
      color: #ffc107;
      background: #212a40;
      border-radius: 7px;
      padding: 2px 14px;
      min-width: 4.6em;
      text-align: center;
      letter-spacing: 0.025em;
      font-family: inherit;
      border: 1.1px solid #009de055;
      box-shadow: 0 1px 7px #009de022;
    }
    .driver-btns {
      display: flex;
      gap: 0.7em;
      margin-top: 8px;
      padding: 0 15px 15px 15px;
    }
    .driver-btns button {
      flex: 1 1 0;
      font-size: 1.03em;
      font-weight: 700;
      border: none;
      border-radius: 9px;
      padding: 0.65em 0;
      background: linear-gradient(90deg,var(--primary),var(--primary-hover));
      color: #fff;
      box-shadow: 0 1px 4px rgba(66,165,245,0.09);
      cursor: pointer;
      letter-spacing: 0.04em;
      transition: background 0.13s;
      min-width: 0;
      font-family: inherit;
    }
    .driver-btns button:active { background: var(--primary-hover);}
    .driver-btns .stop-btn {
      background: linear-gradient(90deg,#ff3b30 30%,#c11 100%);
      color: #fff;
      font-family: inherit;
    }
    .driver-btns .stop-btn:active { background: #ff3b30;}
    .driver-btns .disabled, .driver-btns button:disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .how-to-use {
      width: 100vw;
      max-width: 1050px;
      margin: 18px auto 0 auto;
      padding: 13px 14px 11px 14px;
      background: #161a23cc;
      border-radius: 10px;
      color: #bbdefb;
      font-size: 0.97em;
      font-family: 'Poppins', Arial, sans-serif;
      text-align: left;
      line-height: 1.6;
      letter-spacing: 0.01em;
      box-shadow: 0 2px 8px #212a4033;
      box-sizing: border-box;
      overflow-x: hidden;
      align-self: center;
    }
    .realtime-table {
      width: 98%;
      max-width: 1200px;
      margin: 24px auto 15px auto;
      border-collapse: collapse;
      background: #1b2438;
      border-radius: 14px;
      box-shadow: 0 2px 14px #0a2a5a22;
      overflow-x: auto;
    }
    .realtime-table th, .realtime-table td {
      padding: 9px 17px;
      border-bottom: 1px solid #314264;
      font-size: 1em;
      font-family: 'Poppins', Arial, sans-serif;
    }
    .realtime-table th {
      background: #17305c;
      color: #bbdefb;
      font-weight: 800;
      letter-spacing: 0.03em;
      border-top: none;
    }
    .realtime-table tr:last-child td {
      border-bottom: none;
    }
    .realtime-table td {
      color: #e3f3ff;
      font-weight: 600;
    }
    @media (max-width: 900px) {
      .realtime-table th, .realtime-table td {
        padding: 8px 6px;
        font-size: 0.99em;
      }
      .realtime-table {
        font-size: 0.98em;
      }
    }
    @media (max-width: 700px) {
      .realtime-table {
        width: 100vw;
        font-size: 0.93em;
      }
    }
    @media (max-width: 500px) {
      .realtime-table th, .realtime-table td {
        padding: 7px 3.5vw;
        font-size: 0.94em;
      }
      .realtime-table {
        font-size: 0.93em;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="header">
      <div class="header-row">
        <span class="header-title">
          <i class="fas fa-car"></i> Delivery Drivers Log
        </span>
        <span class="header-desc">
          Ravintola Tandoori Villa &nbsp;|&nbsp; Log car drivers' shift kilometers and time daily
        </span>
      </div>
    </div>
    <div class="driver-addbar">
      <input type="text" id="newDriverName" placeholder="Add driver name..."/>
      <button id="addDriverBtn"><i class="fas fa-plus"></i> Add</button>
    </div>
    <div class="log-board" id="driverBoard"></div>
    <div class="how-to-use" id="howToUse">
      <b>How to use:</b><br>
      1. Add each delivery driver's name at the top.<br>
      2. For each driver, enter today's date and the starting kilometers, then press <b>Start</b>.<br>
      3. At the end of the shift, enter the ending kilometers and press <b>Stop</b>.<br>
      4. The timer and total kilometers will be shown for the day.<br>
      5. Remove a driver using the <i class="fas fa-trash"></i> icon if needed.<br>
      <br>
      <b>Shift Log Table (Realtime):</b>
    </div>
    <div id="realtimeLogs"></div>
    <div class="modal-bg" id="modalBg">
      <div class="modal-content" id="modalContent">
        <button class="modal-close" id="modalClose" title="Close">&times;</button>
        <div class="modal-title"><i class="fas fa-check-circle" style="color:var(--primary);"></i> Shift Log Saved</div>
        <div class="modal-details" id="modalDetails"></div>
        <button class="modal-done-btn" id="modalDone">Done</button>
      </div>
    </div>
  </div>
  <script>
    // CHANGE THIS TO YOUR DEPLOYED APPS SCRIPT WEB APP URL
    // (It must return JSON of all rows for GET, and accept POST as shown)
    const SHEETS_URL = "https://script.google.com/macros/s/AKfycbxNbRF11s4SSQqkvCPRXhxPYo0Xzbztwk9x2iDQ1jApEEMorKAfcrcha60e1mPEItJu3A/exec";

    const DRIVERS_KEY = 'tandoorivillaDrivers_v1';
    function getDrivers() {
      try {
        const d = JSON.parse(localStorage.getItem(DRIVERS_KEY));
        return Array.isArray(d) ? d : [];
      } catch { return []; }
    }
    function setDrivers(drivers) {
      localStorage.setItem(DRIVERS_KEY, JSON.stringify(drivers));
    }
    let driverState = {};
    function pad2(n){return String(n).padStart(2,'0');}
    function formatTimeOnly(d) {
      if(!d) return "";
      if(typeof d === "string") d = new Date(d);
      return pad2(d.getHours())+":"+pad2(d.getMinutes())+":"+pad2(d.getSeconds());
    }
    function formatTime(sec) {
      const h = String(Math.floor(sec/3600)).padStart(2,0);
      const m = String(Math.floor((sec%3600)/60)).padStart(2,0);
      const s = String(sec%60).padStart(2,0);
      return `${h}:${m}:${s}`;
    }
    const newDriverName = document.getElementById('newDriverName');
    const addDriverBtn = document.getElementById('addDriverBtn');
    const driverBoard = document.getElementById('driverBoard');
    const modalBg = document.getElementById('modalBg');
    const modalClose = document.getElementById('modalClose');
    const modalDone = document.getElementById('modalDone');
    const modalDetails = document.getElementById('modalDetails');
    // Realtime logs
    const realtimeLogs = document.getElementById('realtimeLogs');

    function showModal(details) {
      modalDetails.innerHTML = details;
      modalBg.classList.add('active');
      setTimeout(() => { modalDone.focus(); }, 100);
    }
    function hideModal() {
      modalBg.classList.remove('active');
    }
    modalClose.onclick = hideModal;
    modalDone.onclick = hideModal;
    modalBg.onclick = function(e) {
      if (e.target === modalBg) hideModal();
    };

    addDriverBtn.onclick = () => {
      const name = newDriverName.value.trim();
      if (!name) return;
      let drivers = getDrivers();
      if (drivers.includes(name)) return alert("Driver already exists.");
      drivers.push(name);
      setDrivers(drivers);
      newDriverName.value = '';
      renderDrivers();
    };
    newDriverName.addEventListener("keypress", e => {
      if (e.key === "Enter") addDriverBtn.click();
    });
    function removeDriver(name) {
      let drivers = getDrivers();
      drivers = drivers.filter(n => n !== name);
      setDrivers(drivers);
      delete driverState[name];
      renderDrivers();
    }

    function renderDrivers() {
      const drivers = getDrivers();
      driverBoard.innerHTML = "";
      if (!drivers.length) {
        driverBoard.innerHTML = `<div style="color:#93c7e6; text-align:center;margin:1em 0;font-family:'Poppins',sans-serif;font-weight:600;">No drivers. Add some above.</div>`;
        return;
      }
      drivers.forEach(name => {
        if (!driverState[name]) driverState[name] = {
          kmIn: "",
          kmOut: "",
          timer: 0,
          running: false,
          timerInterval: null,
          startTime: null,
          timeIn: null,
          timeOut: null,
          date: (new Date()).toISOString().slice(0,10)
        };
        const s = driverState[name];
        const card = document.createElement('div');
        card.className = 'driver-card' + (s.running ? ' active' : '');
        const headerRow = document.createElement('div');
        headerRow.className = 'driver-card-header';
        const nameEl = document.createElement('span');
        nameEl.className = 'driver-name';
        nameEl.textContent = name;
        const dateEl = document.createElement('input');
        dateEl.type = 'date';
        dateEl.className = 'driver-date';
        dateEl.value = s.date;
        dateEl.onchange = e => { s.date = e.target.value; renderDrivers(); };
        const delBtn = document.createElement('button');
        delBtn.className = 'driver-delete';
        delBtn.title = "Remove driver";
        delBtn.innerHTML = "<i class='fas fa-trash'></i>";
        delBtn.onclick = () => removeDriver(name);
        headerRow.appendChild(nameEl);
        headerRow.appendChild(dateEl);
        headerRow.appendChild(delBtn);
        card.appendChild(headerRow);

        // Start/End fields, with "Km" inside cell
        const fieldsRow = document.createElement('div');
        fieldsRow.className = 'driver-fields-row';

        // In
        const kmInLbl = document.createElement('label');
        kmInLbl.textContent = "In";
        const kmInWrap = document.createElement('span');
        kmInWrap.className = 'input-km-wrap';
        const kmIn = document.createElement('input');
        kmIn.type = 'number';
        kmIn.placeholder = 'Start';
        kmIn.value = s.kmIn;
        kmIn.disabled = s.running;
        kmIn.oninput = e => { s.kmIn = e.target.value; renderKmResult(); };
        const kmInUnit = document.createElement('span');
        kmInUnit.className = 'km-unit';
        kmInUnit.textContent = "Km";
        kmInWrap.appendChild(kmIn);
        kmInWrap.appendChild(kmInUnit);

        fieldsRow.appendChild(kmInLbl);
        fieldsRow.appendChild(kmInWrap);

        // Out
        const kmOutLbl = document.createElement('label');
        kmOutLbl.textContent = "Out";
        const kmOutWrap = document.createElement('span');
        kmOutWrap.className = 'input-km-wrap';
        const kmOut = document.createElement('input');
        kmOut.type = 'number';
        kmOut.placeholder = 'End';
        kmOut.value = s.kmOut;
        kmOut.disabled = !s.running;
        kmOut.oninput = e => { s.kmOut = e.target.value; renderKmResult(); };
        const kmOutUnit = document.createElement('span');
        kmOutUnit.className = 'km-unit';
        kmOutUnit.textContent = "Km";
        kmOutWrap.appendChild(kmOut);
        kmOutWrap.appendChild(kmOutUnit);

        fieldsRow.appendChild(kmOutLbl);
        fieldsRow.appendChild(kmOutWrap);

        card.appendChild(fieldsRow);

        const kmResult = document.createElement('div');
        kmResult.className = 'driver-km-result';
        function renderKmResult() {
          if(s.kmIn && s.kmOut && !isNaN(+s.kmIn) && !isNaN(+s.kmOut) && +s.kmOut >= +s.kmIn) {
            kmResult.innerHTML = `<i class="fas fa-road"></i> Today: <span style="font-weight:900;color:var(--primary)">` + (+s.kmOut - +s.kmIn) + ` km</span>`;
          } else { kmResult.textContent = ''; }
        }
        renderKmResult();
        card.appendChild(kmResult);
        const timerBar = document.createElement('div');
        timerBar.className = 'driver-timer-bar';
        const timerDisplay = document.createElement('span');
        timerDisplay.className = 'driver-timer';
        timerDisplay.textContent = formatTime(s.timer);
        timerBar.appendChild(timerDisplay);
        card.appendChild(timerBar);
        const btns = document.createElement('div');
        btns.className = 'driver-btns';
        const startBtn = document.createElement('button');
        startBtn.innerHTML = `<i class="fas fa-play"></i> Start`;
        startBtn.disabled = s.running || !s.kmIn || !s.date;
        startBtn.onclick = () => {
          s.running = true;
          s.startTime = new Date();
          s.timeIn = new Date();
          s.timer = 0;
          startBtn.disabled = true;
          stopBtn.disabled = false;
          kmIn.disabled = true;
          kmOut.disabled = false;
          timerDisplay.textContent = formatTime(s.timer);
          s.timerInterval = setInterval(() => {
            s.timer = Math.floor((new Date() - s.startTime)/1000);
            timerDisplay.textContent = formatTime(s.timer);
          }, 1000);
          card.classList.add('active');
        };
        btns.appendChild(startBtn);
        const stopBtn = document.createElement('button');
        stopBtn.innerHTML = `<i class="fas fa-stop"></i> Stop`;
        stopBtn.className = "stop-btn";
        stopBtn.disabled = !s.running || !s.kmOut;
        stopBtn.onclick = () => {
          if (!s.kmOut || Number(s.kmOut) < Number(s.kmIn)) {
            alert("Enter valid ending km (greater than or equal to start)");
            return;
          }
          s.running = false;
          if (s.timerInterval) clearInterval(s.timerInterval);
          s.timerInterval = null;
          s.timeOut = new Date();
          startBtn.disabled = false;
          stopBtn.disabled = true;
          kmIn.disabled = false;
          kmOut.disabled = true;
          timerDisplay.textContent = formatTime(s.timer);
          renderKmResult();
          card.classList.remove('active');
          showModal(
            `<b><i class="fas fa-user"></i> ${name}</b><br>
            <span style="color:#fff;">${s.date}</span><br>
            <span style="color:var(--primary)">Total: ${+s.kmOut - +s.kmIn} km</span><br>
            <span>Time: ${formatTime(s.timer)}</span>`
          );
          // ---- SEND TO GOOGLE SHEETS ----
          if (SHEETS_URL && SHEETS_URL.startsWith('https://')) {
            fetch(SHEETS_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: name,
                date: s.date,
                timeIn: s.timeIn ? formatTimeOnly(s.timeIn) : "",
                timeOut: s.timeOut ? formatTimeOnly(s.timeOut) : "",
                kmIn: s.kmIn,
                kmOut: s.kmOut,
                totalKm: +s.kmOut - +s.kmIn,
                totalTime: formatTime(s.timer)
              })
            }).then(r => r.text()).then(() => {
              setTimeout(fetchRealtimeLogs, 800); // update table after small delay
            }).catch(console.error);
          }
          // Reset...
          s.kmIn = ""; s.kmOut = ""; s.timer = 0; s.startTime = null; s.timeIn = null; s.timeOut = null;
          timerDisplay.textContent = formatTime(0);
          renderDrivers();
        };
        btns.appendChild(stopBtn);
        card.appendChild(btns);
        driverBoard.appendChild(card);
      });
    }

    // ---- REALTIME TABLE ----
    function fetchRealtimeLogs() {
      // GET all rows as JSON array of objects
      fetch(SHEETS_URL)
      .then(r=>r.json())
      .then(showRealtimeTable)
      .catch(()=>{realtimeLogs.innerHTML="<div style='color:#e66;margin:18px'>Could not load log data.</div>";});
    }
    function showRealtimeTable(data) {
      // Data: array of {date,name,timeIn,timeOut,kmIn,kmOut,totalKm,totalTime}
      // If Apps Script returns {data: [...]}, use data = data.data;
      if (data && data.data) data = data.data;
      if(!Array.isArray(data) || !data.length){
        realtimeLogs.innerHTML = "<div style='color:#bbb;text-align:center;margin:18px'>No logs yet.</div>";
        return;
      }
      let html = `<table class="realtime-table"><thead>
      <tr><th>Date</th><th>Name</th><th>Time In</th><th>Time Out</th>
      <th>Start Km</th><th>End Km</th><th>Total Km</th><th>Total Time</th></tr></thead><tbody>`;
      for(const row of data){
        html += `<tr>
          <td>${row.date||""}</td>
          <td>${row.name||""}</td>
          <td>${row.timeIn||""}</td>
          <td>${row.timeOut||""}</td>
          <td>${row.kmIn||""}</td>
          <td>${row.kmOut||""}</td>
          <td>${row.totalKm||""}</td>
          <td>${row.totalTime||""}</td>
        </tr>`;
      }
      html += "</tbody></table>";
      realtimeLogs.innerHTML = html;
    }
    setInterval(fetchRealtimeLogs, 3500); // poll every 3.5s for live updates
    fetchRealtimeLogs();

    setInterval(() => {
      Array.from(driverBoard.children).forEach((card, i) => {
        const name = getDrivers()[i];
        const s = driverState[name];
        if (!s) return;
        const btns = card.querySelectorAll('.driver-btns button');
        const kmIn = card.querySelector('.driver-fields-row .input-km-wrap input[type="number"]:nth-child(1)');
        const kmOut = card.querySelectorAll('.driver-fields-row .input-km-wrap input[type="number"]')[1];
        if (btns.length === 2) {
          btns[0].disabled = s.running || !s.kmIn || !s.date;
          btns[1].disabled = !s.running || !s.kmOut;
        }
        if (kmIn) kmIn.disabled = s.running;
        if (kmOut) kmOut.disabled = !s.running;
        const kmResult = card.querySelector('.driver-km-result');
        if(kmResult) {
          if(s.kmIn && s.kmOut && !isNaN(+s.kmIn) && !isNaN(+s.kmOut) && +s.kmOut >= +s.kmIn) {
            kmResult.innerHTML = `<i class="fas fa-road"></i> Today: <span style="font-weight:900;color:var(--primary)">` + (+s.kmOut - +s.kmIn) + ` km</span>`;
          } else { kmResult.textContent = ''; }
        }
        if (s.running) card.classList.add('active');
        else card.classList.remove('active');
      });
    }, 350);
    renderDrivers();
  </script>
</body>
</html>
